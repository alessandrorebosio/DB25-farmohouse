{% extends "core/forms.html" %}
{% load static %}

{% block title %}
{% if event %}
Review Event
{% elif detail %}
Review Service
{% else %}
Review
{% endif %}
{% endblock %}

{% block heading %}
{% if event %}
Review: {{ event.title }}
{% elif detail %}
Review: {{ detail.service.type|lower }}
{% else %}
Review
{% endif %}
{% endblock %}

{% block subheading %}
{% if event %}
{{ event.event_date }}
{% elif detail %}
Booking {{ detail.id }}
{% endif %}
{% endblock %}

{% block form_fields %}
<div class="mb-3">
    <label class="form-label small d-block mb-1">Rating</label>

    <div class="star-rating{% if form.rating.errors %} invalid{% endif %}" role="radiogroup" aria-label="Rating"
        aria-invalid="{% if form.rating.errors %}true{% else %}false{% endif %}">
        {% comment %}
        We render the radios (hidden) and attach visual star labels mapped via 'for' attribute.
        The container uses row-reverse so the highest star appears first visually.
        {% endcomment %}
        {% for radio in form.rating %}
        {{ radio.tag }}
        <label for="{{ radio.id_for_label }}" title="{{ radio.choice_label }}"></label>
        {% endfor %}
    </div>

    {% if form.rating.errors %}
    <div class="invalid-feedback small d-block mt-1">
        {{ form.rating.errors|join:" " }}
    </div>
    {% endif %}
</div>

<div class="mb-3">
    <label for="{{ form.comment.id_for_label }}" class="form-label small">Comment</label>
    <textarea name="{{ form.comment.html_name }}" id="{{ form.comment.id_for_label }}"
        class="form-control {% if form.comment.errors %}is-invalid{% endif %}" rows="4"
        placeholder="Condividi la tua esperienza..."
        maxlength="{% if form.comment.field.max_length %}{{ form.comment.field.max_length }}{% endif %}"
        data-maxlength="{% if form.comment.field.max_length %}{{ form.comment.field.max_length }}{% endif %}"
        data-behavior="comment-textarea"
        data-counter="#comment-count">{{ form.comment.value|default_if_none:'' }}</textarea>
    <div class="form-text text-end"><span id="comment-count">0</span>{% if form.comment.field.max_length %}/{{
        form.comment.field.max_length }}{% endif %}</div>
    {% if form.comment.errors %}
    <div class="invalid-feedback small">
        {{ form.comment.errors|join:" " }}
    </div>
    {% endif %}
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'review/js/review_form.js' %}"></script>
{% endblock %}

{% block submit_label %}Save Review{% endblock %}

{% block extra_links %}
<a href="{% url 'profile' %}" class="text-decoration-none">Back to Profile</a>
{% endblock %}